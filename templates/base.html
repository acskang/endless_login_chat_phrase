{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      {% block title %}Ahading{% endblock %}
    </title>
    <link rel="shortcut icon"
          type="image/x-icon"
          href="{% static 'img/favicon.ico' %}">
    {% block extra_head %}
    {% endblock extra_head %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    {% block extra_css %}
    {% endblock extra_css %}
  </head>
  <body>
    {% csrf_token %}
    <nav class="navbar">
      <div class="nav-container d-flex justify-content-between align-items-center w-100">
        <a href="/" class="logo">TheSysM</a>
        <div class="nav-links">
          {% if user.is_authenticated %}
            <a href="{% url 'phrase:index' %}">Movie Clip</a>
            <a href="{% url 'account:logout' %}">Logout</a>
          {% else %}
            <a onclick="openModal('loginModal')">Login</a>
            <a onclick="openModal('signupModal')">SignUp</a>
          {% endif %}
        </div>
      </div>
    </nav>
    {% block content %}
    {% endblock content %}
    <main class="main-content">
      <div class="welcome-section">
        <h1>Welcome to TheSysM</h1>
        {% if user.is_authenticated %}
          <p>환영합니다, {{ user.username }}님!</p>
        {% else %}
          <p>로그인이 필요합니다</p>
        {% endif %}
      </div>
    </main>
    <!-- Login/Signup Modal -->
    <!-- 로그인 모달 -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('loginModal')">&times;</span>
        <form class="modal-form" method="post" action="{% url 'account:login' %}">
          {% csrf_token %}
          <h2>로그인</h2>
          {% if messages %}
            {% for message in messages %}
              {% if message.tags == 'error' %}
                <div class="toast error"
                     style="display: block;
                            position: relative;
                            top: auto;
                            right: auto;
                            margin-bottom: 1rem">{{ message }}</div>
              {% elif message.tags == 'success' %}
                <div class="toast success"
                     style="display: block;
                            position: relative;
                            top: auto;
                            right: auto;
                            margin-bottom: 1rem">{{ message }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          <input type="text"
                 name="email_or_username"
                 placeholder="이메일 또는 사용자명"
                 required>
          <input type="password" name="password" placeholder="비밀번호" required>
          <button type="submit">로그인</button>
        </form>
      </div>
    </div>
    <!-- 회원가입 모달 -->
    <div id="signupModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('signupModal')">&times;</span>
        <h2>회원가입</h2>
        {% if messages %}
          {% for message in messages %}
            {% if message.tags == 'error' %}
              <div class="toast error"
                   style="display: block;
                          position: relative;
                          top: auto;
                          right: auto;
                          margin-bottom: 1rem">{{ message }}</div>
            {% elif message.tags == 'success' %}
              <div class="toast success"
                   style="display: block;
                          position: relative;
                          top: auto;
                          right: auto;
                          margin-bottom: 1rem">{{ message }}</div>
            {% endif %}
          {% endfor %}
        {% endif %}
        <form class="modal-form"
              id="signupForm"
              method="post"
              action="{% url 'account:signup' %}">
          {% csrf_token %}
          <input id="signupUsername"
                 name="username"
                 type="text"
                 placeholder="사용자명"
                 required>
          <input id="signupEmail" name="email" type="email" placeholder="이메일" required>
          <input id="signupPassword"
                 name="password"
                 type="password"
                 placeholder="비밀번호"
                 required>
          <input id="signupPasswordConfirm"
                 name="password_confirm"
                 type="password"
                 placeholder="비밀번호 확인"
                 required>
          <button type="submit">회원가입</button>
        </form>
      </div>
    </div>
    <!-- Real Chatting -->
    <!-- Chat Floating Button -->
    <button id="chatFloatingBtn"
            class="chat-floating-btn"
            {% if user.is_authenticated %}style="display: flex;"{% else %}style="display: none;"{% endif %}>💬</button>
    <!-- Chat Modal - 항상 렌더링됨 -->
    <div id="chatModal" class="chat-modal">
      <div class="chat-header">
        <div class="chat-title">TheSysM Support</div>
        <button id="closeChat" class="close-chat">✕</button>
      </div>
      <div id="chatMessages" class="chat-messages">
        <div class="message received">
          <div class="message-content">
            <p>반가워요! 난 AI Yaya 에요..</p>
          </div>
        </div>
      </div>
      <div class="chat-input">
        <input type="text"
               id="messageInput"
               class="message-input"
               placeholder="메시지를 입력하세요...">
        <button id="sendMessage" class="send-btn">➤</button>
      </div>
    </div>
    <script src="{% static 'js/modals.js' %}"></script>
    <script src="{% static 'js/chat.js' %}"></script>
    <script src="{% static 'js/script.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
